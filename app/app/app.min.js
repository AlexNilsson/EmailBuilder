var defaultFontFamily=["inherit","Georgia, serif","'Palatino Linotype', 'Book Antiqua', Palatino, serif","'Times New Roman', Times, serif","Arial, Helvetica, sans-serif","'Arial Black', Gadget, sans-serif","'Comic Sans MS', cursive, sans-serif","Impact, Charcoal, sans-serif","'Lucida Sans Unicode', 'Lucida Grande', sans-serif","Tahoma, Geneva, sans-serif","'Trebuchet MS', Helvetica, sans-serif","Verdana, Geneva, sans-serif","'Courier New', Courier, monospace","'Lucida Console', Monaco, monospace"];Vue.config.devtools=!0;var confs={storage:{get:function(){return new Promise(function(t,e){try{var n={elements:[],html:"",emailSettings:{options:{width:600,paddingTop:50,paddingBottom:50,backgroundColor:"#f4f5f4"},type:"emailSettings"}};setTimeout(function(){t(n)},300)}catch(t){utils.notify(t).error(),e(t)}})},put:function(t){return new Promise(function(e,n){try{t.html=utils.removeLineBreaks(t.html),localStorage.setItem("jqueryEmail",JSON.stringify(t)),e()}catch(t){utils.notify(t).error(),n(t)}})}},options:{urlToUploadImage:"//uploads.im/api",trackEvents:!1,mjmlPublicKey:"961d11e0-9ddc-47ed-95c6-825951e60d14",mjmlApplicationId:"17ba7701-c1aa-48ba-8407-443505ae5d43",assetsPath:"http://localhost:9000/assets"}},utils={snakeToCamel:function(t){return"string"!=typeof t?t:t.replace(/_([a-z])/gi,function(t,e){return""+e.toUpperCase()})},camelToSnake:function(t){return"string"!=typeof t?t:t.replace(/([A-Z])/g,function(t,e){return"_"+e.toLowerCase()})},uid:function(t){return(t||"id")+(new Date).getTime()+"RAND"+Math.ceil(1e5*Math.random())},compileMJML:function(t){function e(t){var e="";switch(t.type){case"button":var n=t.options.font.italic?"italic":"normal",i="true"===t.options.fullWidth?"100%":"auto",o="link"===t.options.linkTo.type&&t.options.linkTo.link||"email"===t.options.linkTo.type&&"mailto:"+t.options.linkTo.link||null;return e="",e+="<tr>",e+='<td style="background-color: '+t.options.backgroundColor+"; padding:"+utils.paddingArrayToString(t.options.padding)+"; text-align: "+t.options.align+';">',e+='<a href="'+o+'" style="background-color: '+t.options.buttonBackgroundColor+"; color: "+t.options.font.color+"; font-family: "+t.options.font.family+"; font-size: "+t.options.font.size+"px; line-height: 19px; display: inline-block; border-radius: "+t.options.border.radius+"px; border: "+t.options.border.size+"px "+t.options.border.style+" "+t.options.border.color+"; text-decoration: none; font-style: "+n+"; font-weight: "+t.options.font.weight+"; margin: 0px; width: "+i+"; padding: "+utils.paddingArrayToString(t.options.innerPadding)+';">',e+=t.options.buttonText,e+="</a>",e+="</td>",e+="</tr>",{tagName:"mj-table",attributes:{padding:utils.paddingArrayToString(t.options.margin)},content:e};case"text":var a=function(t){var e=0,n=t.options.font.size;switch(t.options.lineHeight){case"s1":e=n;break;default:case"s2":e=1.25*n;break;case"s3":e=1.5*n;break;case"s4":e=2*n}return e+"px"}(t);return e="",e+="<tr>",e+='<td style="background-color:'+t.options.backgroundColor+"; padding:"+utils.paddingArrayToString(t.options.padding)+';">',e+='<div style="cursor: auto; color: rgb(0, 0, 0); font-family: '+t.options.font.family+"; font-size: "+t.options.font.size+"px; line-height: "+a+'; text-align: left;">',e+=t.options.text,e+="</div>",e+="</td>",e+="</tr>",{tagName:"mj-table",attributes:{padding:"none"},content:e};case"divider":return e="",e+="<tr>",e+='<td style="font-size: 0px; word-wrap: break-word; background-color: '+t.options.backgroundColor+"; padding: "+utils.paddingArrayToString(t.options.padding)+';">',e+='<p style=" font-size: 1px; margin: 0px auto; border-top: '+t.options.border.size+"px "+t.options.border.style+" "+t.options.border.color+'; width: 100%;"></p>',e+="</td>",e+="</tr>",{tagName:"mj-table",attributes:{padding:utils.paddingArrayToString(t.options.margin)},content:e};case"image":return e="",e+="<tr>",e+='<td align="'+t.options.align+'" style="background-color: '+t.options.backgroundColor+"; padding: "+utils.paddingArrayToString(t.options.padding)+';">',e+='<a href="'+t.options.url+'">',e+='<img src="'+t.options.image+'" alt="'+t.options.altTag+'" style="display: block; max-width: 100%; width: '+t.options.width+'px;">',e+="</a>",e+="</td>",e+="</tr>",{tagName:"mj-table",attributes:{padding:utils.paddingArrayToString(t.options.margin)},content:e};case"social":var r="";return Object.keys(t.options.links).forEach(function(e){t.options.links[e].active&&(r+='<a href="'+t.options.links[e].link+'" target="_blank" style="border: none;text-decoration: none;">\n                                                <img border="0" width="'+t.options.iconSize+'" src="'+confs.options.assetsPath+"/social/"+e+'.png">\n                                            </a>')}),e="",e+="<tr>",e+='<td align="'+t.options.align+'" style="line-height: 0; color:'+t.options.color+"; background-color: "+t.options.backgroundColor+"; padding: "+utils.paddingArrayToString(t.options.padding)+';">',e+=r,e+="</td>",e+="</tr>",{tagName:"mj-table",attributes:{padding:utils.paddingArrayToString(t.options.margin)},content:e};case"video":var l="true"===t.options.fullWidth?"100%":t.options.width,s="center"===t.options.align?"none":t.options.align,d='<iframe style="float: '+s+"; width: "+l+'px !important;" width='+l+" height="+t.options.height+" src="+t.options.url+" frameborder='0' allowfullscreen></iframe>";return e="",e+="<tr>",e+='<td style="line-height: 0; font-size: 0; background-color: '+t.options.backgroundColor+"; padding: "+utils.paddingArrayToString(t.options.padding)+'; ">',e+=d,e+="</td>",e+="</tr>",{tagName:"mj-table",attributes:{padding:utils.paddingArrayToString(t.options.margin)},content:e};case"html":return{tagName:"mj-text",attributes:{"font-size":"13px",color:"rgb(0, 0, 0)","line-height":"20px",padding:0},content:t.options.html};case"products":e="";for(var p=0;p<t.options.rows;p++){e+="<tr>";for(var c=0;c<t.options.columns;c++){e+='<td style="padding: '+utils.paddingArrayToString(t.options.padding)+"; background-color: "+t.options.backgroundColor+';">',e+='<div style="box-sizing: border-box; padding: 2px; text-align: center; width: 100%;">';var u=t.options.products[p*t.options.columns+c];e+='<div style="box-sizing: border-box;">',e+='<img style="max-width: 100%;" src="'+u.image+'" alt="'+u.name+'" align="center">',e+="</div>",e+='<div style="margin-bottom: 20px;">',t.options.showProductName&&(e+='<h1 style="font-size: 20px; font-weight: bold; padding: 4px; margin: 0; margin-top: 8px;">'+u.name+"</h1>"),t.options.showProductPrice&&(e+='<h2 style="padding: 8px; margin-bottom: 8px; font-size: 16px; margin-top: 0px;">'+u.price+"</h2>"),t.options.showProductButton&&(e+='<a href="'+u.buyURL+'" style="display: inline-block; text-decoration: none; padding: 12px 20px; background-color:'+u.buttonColor+'; border: 0; border-radius: 2px; font-weight: bold; color: #fff;">'+u.buttonText+"</a>"),e+="</div>",e+="</div>",e+="</td>"}e+="</tr>"}return{tagName:"mj-table",attributes:{padding:utils.paddingArrayToString(t.options.margin)},content:e};default:return console.error("unknown element:",t.type),!1}}t=t||{};var n=[];return t.elements.forEach(function(t){var i=(void 0!==t.options.margin&&utils.paddingArrayToString(t.options.margin),{tagName:"mj-section",attributes:{"full-width":"full-width","background-color":"transparent",padding:"none"},children:[]});"section"===t.type?t.options.columns.forEach(function(t){i.children.push({tagName:"mj-column",attributes:{"background-color":"transparent"},children:t.elements.map(function(t){return e(t)})})}):i.children.push({tagName:"mj-column",attributes:{width:"100%","background-color":"transparent"},children:[e(t)]}),n.push(i)}),{tagName:"mjml",attributes:{},children:[{tagName:"mj-head",attributes:{},children:[{tagName:"mj-title",content:t.name},{tagName:"mj-style",attributes:{},content:"@media all and (max-width: 480px) { td { width: 100%!important; } } iframe { width: 100%!important; }"}]},{tagName:"mj-body",attributes:{},children:[{tagName:"mj-container",attributes:{"background-color":t.emailSettings.options.backgroundColor},children:[{tagName:"mj-wrapper",attributes:{"padding-top":t.emailSettings.options.paddingTop+"px","padding-bottom":t.emailSettings.options.paddingBottom+"px"},children:n}]}]}]}},createEmail:function(t){var e=this.compileMJML(t);return new Promise(function(t,n){if(!confs.options.mjmlPublicKey||!confs.options.mjmlApplicationId)return console.log("api failure"),n("You did'nt include MJML API keys!");var i=JSON.stringify({mjml:JSON.stringify(e)});return $.ajax({url:"https://api.mjml.io/v1/render",method:"POST",data:i,datatype:"json",processData:!1,beforeSend:function(t){t.setRequestHeader("Authorization","Basic "+btoa(confs.options.mjmlApplicationId+":"+confs.options.mjmlPublicKey))},success:function(e){return t(e)},error:function(t,e,n){console.error(t,e,n)}})})},notify:function(t,e){return{log:function(){return alertify.log(t,e)},success:function(){alertify.success(t,e)},error:function(){alertify.error(t,e)}}},confirm:function(t,e,n,i,o){confirm(t)?(e||Function)():(n||Function)()},alert:function(t){return alertify.okBtn("Accept").alert(t)},prompt:function(t,e,n,i){return alertify.defaultValue(t).prompt(e,n,i)},validateEmail:function(t){return Vue.util.isObject(t)&&$.isArray(t.elements)&&"string"==typeof t.html&&Vue.util.isObject(t.emailSettings)&&"emailSettings"===t.emailSettings.type&&Vue.util.isObject(t.emailSettings.options)},trackEvent:function(t,e,n){if(confs.trackEvents){if(!ga)throw new Error("To track events, include Google analytics code in index.html");return ga("send","event",t,e,n)}},equals:function(t,e){function n(t,e){var n=$.extend(!0,{},t);return JSON.stringify(n)===JSON.stringify($.extend(!0,n,e))}return n(t,e)&&n(e,t)},removeLineBreaks:function(t){return t.replace(/\n\s*\n/gi,"\n")},initTooltips:function(){setTimeout(function(){$("i[title]").powerTip({placement:"sw-alt"})},100)},paddingArrayToString:function(t){return t.join("px ")+"px"}},emailBuilder=new Vue({data:function(){return{loading:!0}},components:{"email-builder-component":function(t,e){Promise.all([$.get("builder/builder.html"),confs.storage.get()]).then(function(e){function n(t,e){if(t){if(Array.isArray(t))return e?t.slice():t;var n,a;if(o&&o(t),"object"==typeof t&&"function"==typeof(e=t[i])?(n=e.call(t),a=[]):t+""=="[object Generator]"&&(n=t,a=[]),o&&o(void 0),a){for(;e=n.next(),!0!==e.done;)a.push(e.value);return a}}throw new Error(t+" is not iterable")}var i="undefined"!=typeof Symbol&&Symbol&&Symbol.iterator||"@@iterator",o="undefined"!=typeof Symbol&&Symbol&&Symbol.__setObjectSetter__;t({data:function(){return{preview:!1,currentElement:{},currentTab:"elements",selectedNetwork:"",emailScreenMode:"desktop",elements:[{type:"text",icon:"&#xE8EE;",primary_head:"Text",second_head:"Editable text box"},{type:"image",icon:"&#xE40B;",primary_head:"Image",second_head:"Image without text"},{type:"divider",icon:"&#xE8E9;",primary_head:"Divider",second_head:"1px separation line"},{type:"button",icon:"&#xE913;",primary_head:"Button",second_head:'Clickable URL button"'},{type:"social",icon:"share",primary_head:"Social Sharing",second_head:"4 social icons"},{type:"html",icon:"code",primary_head:"HTML Block",second_head:"Editable HTML block"},{type:"video",icon:"video_library",primary_head:"Video",second_head:"Embed video source"},{type:"products",icon:"view_module",primary_head:"Products",second_head:"Grid of Products"}],sectionTypes:[{type:"section",icon:"II",columns:2,primary_head:"a 2 column section"},{type:"section",icon:"III",columns:3,primary_head:"a 3 column section"},{type:"section",icon:"IIII",columns:4,primary_head:"a 4 column section"}],defaultOptions:{divider:{type:"divider",options:{subSection1:"Divider style",border:{size:1,style:"solid",styleOptions:["solid","dashed","dotted"],color:"#DADFE1"},backgroundColor:"#ffffff",margin:[0,0,0,0],padding:[15,15,15,15]}},text:{type:"text",options:{subSection1:"Text style",font:{size:16,sizeOptions:[9,10,11,12,13,14,16,18,24,30,36,48,60,62],family:"inherit",familyOptions:defaultFontFamily},lineHeight:"s2",backgroundColor:"#ffffff",padding:[15,15,15,15],text:"Lorem ipsum dolor sit amet, consectetur adipisci elit, sed eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur. Quis aute iure reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat cupiditat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."}},html:{type:"html",options:{html:"<p>Lorem ipsum dolor sit amet, consectetur adipisci elit, sed eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur. Quis aute iure reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat cupiditat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. </p>"}},button:{type:"button",options:{subSection1:"Button settings",buttonText:"Click me",linkTo:{type:"none",typeOptions:["link","email","none"],link:""},subSection2:"Border style",border:{size:1,radius:3,color:"#3498DB",style:"solid",styleOptions:["dotted","solid","dashed"]},subSection3:"Button style",fullWidth:"false",align:"center",buttonBackgroundColor:"#3498DB",backgroundColor:"#ffffff",font:{size:16,sizeOptions:[9,10,11,12,13,14,16,18,24,30,36,48,60,62],color:"#ffffff",weight:"normal",italic:"",weightOptions:["bold","lighter","inherit","initial","normal",100,200,300,400,500,600,700,800,900],family:"inherit",familyOptions:defaultFontFamily},innerPadding:[12,20,12,20],margin:[0,0,0,0],padding:[15,15,15,15]}},image:{type:"image",options:{subSection1:"Image settings",image:"assets/350x150.jpg",altTag:"",url:"",subSection2:"Image style",width:370,align:"center",backgroundColor:"#ffffff",margin:[0,0,0,0],padding:[15,15,15,15]}},video:{type:"video",options:{subSection1:"Video settings",url:"https://www.youtube.com/embed/cbk8mXPyCcc",subSection2:"Video style",fullWidth:"true",width:600,height:350,align:"center",backgroundColor:"#ffffff",margin:[0,0,0,0],padding:[0,0,0,0]}},products:{type:"products",options:{subSection1:"Product settings",rows:1,columns:2,populateFromSource:{isActive:!0,source:"optionA",sourceOptions:["optionA","optionB"],autoRecommend:!0},subSection2:"Product style",activeProduct:{},products:[{id:1,name:"Product-1",image:"assets/154x160.jpg",price:"$199",buttonText:"Buy now!",buttonColor:"#00abee",buyURL:"/addToCart1"},{id:2,name:"Product-2",image:"assets/154x160.jpg",price:"$199",buttonText:"Buy now!",buttonColor:"#00abee",buyURL:"/addToCart1"},{id:3,name:"Product-3",image:"assets/154x160.jpg",price:"$199",buttonText:"Buy now!",buttonColor:"#00abee",buyURL:"/addToCart1"},{id:4,name:"Product-4",image:"assets/154x160.jpg",price:"$199",buttonText:"Buy now!",buttonColor:"#00abee",buyURL:"/addToCart1"},{id:5,name:"Product-5",image:"assets/154x160.jpg",price:"$199",buttonText:"Buy now!",buttonColor:"#00abee",buyURL:"/addToCart1"},{id:6,name:"Product-6",image:"assets/154x160.jpg",price:"$199",buttonText:"Buy now!",buttonColor:"#00abee",buyURL:"/addToCart1"},{id:7,name:"Product-7",image:"assets/154x160.jpg",price:"$199",buttonText:"Buy now!",buttonColor:"#00abee",buyURL:"/addToCart1"},{id:8,name:"Product-8",image:"assets/154x160.jpg",price:"$199",buttonText:"Buy now!",buttonColor:"#00abee",buyURL:"/addToCart1"},{id:9,name:"Product-9",image:"assets/154x160.jpg",price:"$199",buttonText:"Buy now!",buttonColor:"#00abee",buyURL:"/addToCart1"},{id:10,name:"Product-10",image:"assets/154x160.jpg",price:"$199",buttonText:"Buy now!",buttonColor:"#00abee",buyURL:"/addToCart1"},{id:11,name:"Product-11",image:"assets/154x160.jpg",price:"$199",buttonText:"Buy now!",buttonColor:"#00abee",buyURL:"/addToCart1"},{id:12,name:"Product-12",image:"assets/154x160.jpg",price:"$199",buttonText:"Buy now!",buttonColor:"#00abee",buyURL:"/addToCart1"}],showProductName:"true",showProductButton:"true",showProductPrice:"true",backgroundColor:"#ffffff",margin:[0,0,0,0],padding:[0,0,0,0]}},section:{type:"section",options:{margin:[15,15,15,15],padding:[15,15,15,15],backgroundColor:"#ffffff",columns:[{elements:[]},{elements:[]}]}},unsubscribe:{type:"unsubscribe",options:{padding:[10,50,10,50],backgroundColor:"#eeeeee",font:{weight:"normal",weightOptions:["bold","bolder","lighter","inherit","initial","normal",100,200,300,400,500,600,700,800,900],family:"Arial, Helvetica, sans-serif",familyOptions:defaultFontFamily},text:'<p style="text-align: center; margin: 0px 0px 10px 0px; line-height: 1; font-size: 20px;" data-block-id="text-area"><span style="font-size: 8pt; color: #333333;">If you\'d like to unsubscribe and stop receiving these emails<span style="color: #0000ff;"> <a style="color: #0000ff;" href="#">click here</a></span>.</span></p>'}},social:{type:"social",options:{subSection1:"Social setting",links:{facebook:{link:"https://www.facebook.com/envato",active:!0},twitter:{link:"https://twitter.com/envatomarket",active:!0},linkedin:{link:"",active:!1},youtube:{link:"https://www.youtube.com/user/Envato",active:!0}},subSection2:"Social style",iconSize:48,align:"center",backgroundColor:"#ffffff",margin:[0,0,0,0],padding:[10,15,10,15]}}},Email:e[1],lastElementIds:[],clonedEmail:JSON.parse(JSON.stringify(e[1]))}},mounted:function(){var t=this;this.$root._data.loading=!1,this.Email=$.extend(!0,{},{elements:this.Email.elements.map(function(e){return t.clone(e)}),emailSettings:this.clone(this.Email.emailSettings)},this.Email)},watch:{Email:{handler:function(){},deep:!0},preview:function(t,e){tinymce.editors.forEach(function(e){return e[t?"hide":"show"]()})},currentElement:function(){}},computed:{loading:function(){return this.$root._data.loading}},methods:{hasChanges:function(){return!utils.equals(this.Email,this.clonedEmail)},setCurrentElement:function(t,e){var n=this;n.preview||n.currentElement===e||(n.currentElement={},n.currentTab="emailSettings"==t?"emailSettings":"elements",setTimeout(function(){n.currentElement=e},10))},editElement:function(t){if(!t)return this.currentElement={};var e=this,n="emailSettings"!==t?e.Email.elements.find(function(e){return e.id===t}):e.Email[t];e.setCurrentElement(t,n)},editSectionElement:function(t,e,n){if(!t)return this.currentElement={};var i,o=this;i="emailSettings"!==t?o.Email.elements[e].options.columns[n].elements.find(function(e){return e.id===t}):o.Email[t],o.setCurrentElement(t,i)},editElementWithId:function(t){if(!t)return this.currentElement={};var e=this,n=e.Email.elements.find(function(e){return e.id===t});return void 0===n&&(n=e.Email.elements.filter(function(t){return"section"===t.type}).map(function(t){return t.options.columns.map(function(t){return t.elements}).reduce(function(t,e){return t.concat(e)})}).reduce(function(t,e){return t.concat(e)}).find(function(e){return e.id===t})),void 0!==n&&"section"!==n.type&&e.setCurrentElement(t,n),this.currentElement={}},removeElement:function(t){var e=this;return utils.confirm("Are you sure?",function(){e.Email.elements=e.Email.elements.filter(function(e){return e!==t}),utils.equals(e.currentElement,t)&&(e.currentElement={})},null,"Delete element","Don't delete")},removeSectionElement:function(t,e,n){var i=this;return utils.confirm("Are you sure?",function(){i.Email.elements[e].options.columns[n].elements=i.Email.elements[e].options.columns[n].elements.filter(function(e){return e!==t}),utils.equals(i.currentElement,t)&&(i.currentElement={})},null,"Delete element","Don't delete")},saveEmailTemplate:function(){var t=this;utils.createEmail(t.Email).then(function(e){if(e.errors.length)return utils.notify(e.errors.map(function(t){return t.message}).join("<br>")).error();t.Email.html=e.html,confs.storage.put(t.Email).then(function(){utils.notify("Email has been saved.").success(),utils.trackEvent("Email","saved"),t.clonedEmail=JSON.parse(JSON.stringify(t.Email)),t.currentElement={}})},function(t){return utils.notify(t).error()})},addSocialNetwork:function(t,e){e&&(t[e].active=!0)},previewEmail:function(){if(!this.Email.elements.length)return utils.notify("Nothing to preview, please add some elements.").log();this.preview=!0,this.currentElement={}},exportEmail:function(){if(!this.Email.elements.length)return utils.notify("Nothing to export, please add some elements.").log();var t=document.createElement("a");t.href="data:attachment/html,"+encodeURI(this.Email.html),t.target="_blank",t.download=utils.uid("export")+".html",document.body.appendChild(t),t.click(),document.body.removeChild(t)},cloneElement:function(t){var e=JSON.parse(JSON.stringify(t));e.id=utils.uid(),this.Email.elements.splice(this.Email.elements.indexOf(t)+1,0,e)},cloneSectionElement:function(t,e,n){var i=JSON.parse(JSON.stringify(t));i.id=utils.uid();var o=this.Email.elements[e].options.columns[n].elements;o.splice(o.indexOf(t)+1,0,i)},clone:function(t){var e=$.extend(!0,{},this.defaultOptions[t.type]);if(e.id=utils.uid(),e.component=t.type+"Template","section"===t.type){e.options.columns=[];for(var n=0;n<t.columns;n++)e.options.columns.push({elements:[]})}return e},onMove:function(){tinymce.editors.forEach(function(t){return t.hide()})},onMoveEnd:function(){tinymce.editors.forEach(function(t){return t.show()})},getElementIds:function(){var t,e=this.Email.elements.map(function(t){var e;if("sectionTemplate"===t.component){var i=t.options.columns.map(function(t){return t.elements.map(function(t){return t.id})});return i=(e=Array.prototype).concat.apply(e,n(i)),i.push(t.id),i}return t.id});return(t=Array.prototype).concat.apply(t,n(e))},onNewDragableElementClick:function(){this.lastElementIds=this.getElementIds()},onElementAdded:function(){var t=this,e=this.getElementIds(),n=e.filter(function(e){return t.lastElementIds.indexOf(e)<0});this.editElementWithId(n[0])},importJson:function(){var t=this,e=$("<input />",{type:"file",name:"import-file"}).on("change",function(){var e=new FileReader;e.onload=function(){var n=JSON.parse(e.result);utils.validateEmail(n)?confs.storage.put(n).then(function(){t.currentElement={},t.Email=$.extend(!0,{},n),t.clonedEmail=$.extend(!0,{},n),utils.notify("Email has been imported").success()}):utils.notify("Imported data isn't valid.").error()};var n=this.files[0];if("json"!==n.name.slice(-4))return utils.notify("Invalid format file").log();e.readAsText(n)});return t.Email.elements.length?utils.confirm("On import all current details will be deleted!",function(){return e.click()},function(){return utils.notify("Import canceled").log()},"accept","deny"):e.click()},exportJson:function(){var t=document.createElement("a");t.target="_blank",t.href="data:attachment/json,"+encodeURI(JSON.stringify(this.Email)),t.download=utils.uid("export")+".json",document.body.appendChild(t),t.click(),document.body.removeChild(t)},setImageURL:function(t){this.currentElement.options.image=t},selectImage:function(){API.onBrowseImages()},setProducts:function(t){this.currentElement.options.products=t},selectProducts:function(){API.onBrowseProducts()}},template:e[0],directives:{mdInput:{bind:function(t,e,n){var i=$(t),o=function(){i.closest(".md-input-wrapper").removeClass("md-input-wrapper-danger md-input-wrapper-success md-input-wrapper-disabled"),i.hasClass("md-input-danger")&&i.closest(".md-input-wrapper").addClass("md-input-wrapper-danger"),i.hasClass("md-input-success")&&i.closest(".md-input-wrapper").addClass("md-input-wrapper-success"),i.prop("disabled")&&i.closest(".md-input-wrapper").addClass("md-input-wrapper-disabled"),i.hasClass("label-fixed")&&i.closest(".md-input-wrapper").addClass("md-input-filled"),""!=i.val()&&i.closest(".md-input-wrapper").addClass("md-input-filled")};setTimeout(function(){i.hasClass("md-input-processed")||(i.prev("label").length?i.prev("label").addBack().wrapAll('<div class="md-input-wrapper"/>'):i.wrap('<div class="md-input-wrapper"/>'),i.addClass("md-input-processed").closest(".md-input-wrapper").append('<span class="md-input-bar"/>')),o()},100),i.on("focus",function(){}).on("blur",function(){setTimeout(function(){i.closest(".md-input-wrapper").removeClass("md-input-focus"),""==i.val()?i.closest(".md-input-wrapper").removeClass("md-input-filled"):i.closest(".md-input-wrapper").addClass("md-input-filled")},100)})}},inputFileUpload:{twoWay:!0,bind:function(t,e,n){var i=$(t).find("button"),o=$(t).find(".uploading"),a=$(t).find(".image-path"),r=a.text;if(/uploads.im/.test(confs.options.urlToUploadImage)&&"https:"===location.protocol)return void console.error("Sorry, but uploads.im don't support https!");setTimeout(function(){var e=$("<input/>",{type:"file",name:"file"}).bind("change",function(e){if(!confs.options.urlToUploadImage)throw Error("You don't set the 'urlToUploadImage' in variables.");var n=$(e.target);n.prop("disabled",!0),r=a[0].value,a.text("Uploading"),o.addClass("active");var i=new FormData;return i.append("upload",e.target.files[0]),$.ajax({url:confs.options.urlToUploadImage,data:i,processData:!1,contentType:!1,type:"POST",success:function(e){if(200==e.status_code){var n=new Event("input",{bubbles:!0});$(t).find("input.image-path").val(e.data.img_url),$(t).find("input.image-path").get(0).dispatchEvent(n),utils.notify("Your image has been uploaded").log()}else utils.notify(e.status_txt).error()},error:function(t){utils.notify(t.statusText).error()},complete:function(){n.prop("disabled",!1),a.text(r),o.removeClass("active")}})});i.on("click",function(t){return t.preventDefault(),/uploads.im/.test(confs.options.urlToUploadImage)&&"https:"==location.protocol?(a.text(r),utils.notify("Sorry, but uploads.im don't support https!").error()):e.click()})},100)},unbind:function(t){$(t).unbind("change")}}},filters:{makeTitle:function(t){return t?(t=utils.camelToSnake(t),t=t.charAt(0).toUpperCase()+t.slice(1),t.replace(/_/g," ")):""},capitalize:function(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}},components:{colorPicker:{props:["color"],template:'\n                <div class="color-input-container">\n                    <div class="current-color" color-picker @click="openColorPicker" :style="{ backgroundColor: color }"></div>\n                    <input class="input" v-md-input id="elementBackgroundColor" type="text" @input="update()" v-model="color" />\n                    <input type="color" ref="inputColor" @input="update()" style="display: none; visibility: hidden" v-model="color" />\n                </div>\n              ',methods:{update:function(){this.$emit("update:color",this.color)},openColorPicker:function(){$(this.$refs.inputColor).trigger("click")}}},buttonTemplate:{props:["element"],template:'<table width="100%" class="main" cellspacing="0" cellpadding="0" border="0" align="center" style="display: table;" data-type="button"><tbody><tr><td :style="{paddingTop: `${element.options.margin[0]}px`, paddingBottom: `${element.options.margin[2]}px`, paddingLeft: `${element.options.margin[3]}px`, paddingRight: `${element.options.margin[1]}px`}"><table cellspacing="0" cellpadding="0" border="0" align="center" width="100%" :style="{ textAlign: element.options.align }"><tbody><tr><td class="button" :style="{ backgroundColor: element.options.backgroundColor, paddingTop: `${this.element.options.padding[0]}px`, paddingRight: `${this.element.options.padding[1]}px`, paddingBottom: `${this.element.options.padding[2]}px`, paddingLeft: `${this.element.options.padding[3]}px`}">'+"<a :style=\"{backgroundColor: element.options.buttonBackgroundColor, color: element.options.font.color, fontFamily: element.options.font.family, fontSize: element.options.font.size + 'px', lineHeight: '19px', display: element.options.fullWidth === 'true' ? 'block' : 'inline-block', borderRadius: element.options.border.radius + 'px', border: `${element.options.border.size}px ${element.options.border.style}  ${element.options.border.color}`, textAlign: 'center',  textDecoration: 'none', fontWeight: element.options.font.weight, fontStyle: element.options.font.italic, margin: 0, width: 'auto', paddingTop: `${this.element.options.innerPadding[0]}px`, paddingRight: `${this.element.options.innerPadding[1]}px`, paddingBottom: `${this.element.options.innerPadding[2]}px`, paddingLeft: `${this.element.options.innerPadding[3]}px`}\" class=\"button-1\" :href=\"element.options.linkTo.link\" data-default=\"1\">{{ element.options.buttonText }}</a> \x3c!--[if mso]></center></v:roundrect><![endif]--\x3e</td></tr></tbody></table></td></tr></tbody></table>"},textTemplate:{props:["element"],computed:{lineHeight:function(){var t=0,e=this.element.options.font.size;switch(this.element.options.lineHeight){case"s1":t=e;break;default:case"s2":t=1.25*e;break;case"s3":t=1.5*e;break;case"s4":t=2*e}return t}},template:'<table width="100%" class="main" cellspacing="0" cellpadding="0" border="0" style="display: table;" align="center" data-type="text-block"><tbody><tr><td><table cellspacing="0" cellpadding="0" border="0" align="center" width="100%"><tbody><tr><td class="block-text" data-block-id="background" align="left" :style="{ backgroundColor: element.options.backgroundColor, paddingTop: `${this.element.options.padding[0]}px`, paddingRight: `${this.element.options.padding[1]}px`, paddingBottom: `${this.element.options.padding[2]}px`, paddingLeft: `${this.element.options.padding[3]}px`, fontFamily: this.element.options.font.family, fontSize: `${this.element.options.font.size}px`, lineHeight: `${lineHeight}px`}" style=" color: #000000;"><tinymce v-model="element.options.text"/></td></tr></tbody></table></td></tr></tbody></table>'},htmlTemplate:{props:["element"],template:'<table width="100%" class="main" cellspacing="0" cellpadding="0" border="0" align="center" data-type="html-block"><tbody><tr><td class="block-text" data-block-id="background" align="left" v-html="element.options.html"></td></tr></tbody></table>'},socialTemplate:{props:["element"],template:'<table width="100%" class="main" align="center" cellspacing="0" cellpadding="0" border="0"  style="display: table;" data-type="social-links"><tbody><tr><td :style="{ paddingTop: `${element.options.margin[0]}px`, paddingBottom: `${element.options.margin[2]}px`, paddingLeft: `${element.options.margin[3]}px`, paddingRight: `${element.options.margin[1]}px`}"><table cellspacing="0" cellpadding="0" border="0" align="center" width="100%"><tbody><tr><td class="social" :align="this.element.options.align" :style="{ backgroundColor: this.element.options.backgroundColor, paddingTop: `${this.element.options.padding[0]}px`, paddingRight: `${this.element.options.padding[1]}px`, paddingBottom: `${this.element.options.padding[2]}px`, paddingLeft: `${this.element.options.padding[3]}px`}"><a :href="element.options.links.facebook.link" v-if="element.options.links.facebook.active" target="_blank" style="border: none;text-decoration: none;" class="facebook"><img :width="element.options.iconSize" border="0" src="'+location.origin+'/assets/social/facebook.png"></a><a :href="element.options.links.twitter.link" v-if="element.options.links.twitter.active" target="_blank" style="border: none;text-decoration: none;" class="twitter"><img :width="element.options.iconSize" border="0" src="'+location.origin+'/assets/social/twitter.png"></a><a :href="element.options.links.linkedin.link" v-if="element.options.links.linkedin.active" target="_blank" style="border: none;text-decoration: none;" class="linkedin"><img :width="element.options.iconSize" border="0" src="'+location.origin+'/assets/social/linkedin.png"></a><a :href="element.options.links.youtube.link"  v-if="element.options.links.youtube.active" target="_blank" style="border: none;text-decoration: none;" class="youtube"><img :width="element.options.iconSize" border="0" src="'+location.origin+'/assets/social/youtube.png"></a></td></tr></tbody></table></td></tr></tbody></table>'},unsubscribeTemplate:{props:["element"],
template:'<table width="100%" class="main" cellspacing="0" cellpadding="0" border="0" :style="{backgroundColor: element.options.backgroundColor, marginTop: `${element.options.margin[0]}px`, marginBottom: `${element.options.margin[2]}px`, marginLeft: `${element.options.margin[3]}px`, marginRight: `${element.options.margin[1]}px`}" style="display: table;" align="center" data-type="text-block"><tbody><tr><td data-block-id="background" align="left" :style="{paddingTop: this.element.options.padding[0], paddingRight: this.element.options.padding[3], paddingBottom: this.element.options.padding[2], paddingLeft: this.element.options.padding[3], fontFamily: element.options.font.family, fontWeight: element.options.font.weight, margin: 0,color: element.options.color }" style="font-family: Arial,serif; font-size: 13px; color: #000000; line-height: 22px;"><tinymce v-model="element.options.text"/></td></tr></tbody></table>'},dividerTemplate:{props:["element"],template:'<table width="100%" class="main" cellspacing="0" cellpadding="0" style="border: 0; display: table;" border="0" align="center" data-type="divider"><tbody><tr><td :style="{paddingTop: `${element.options.margin[0]}px`, paddingBottom: `${element.options.margin[2]}px`, paddingLeft: `${element.options.margin[3]}px`, paddingRight: `${element.options.margin[1]}px`}"><table cellspacing="0" cellpadding="0" border="0" align="center" width="100%"><tbody><tr><td class="divider-simple" :style="{ backgroundColor: element.options.backgroundColor, paddingTop: `${this.element.options.padding[0]}px`, paddingRight: `${this.element.options.padding[1]}px`, paddingBottom: `${this.element.options.padding[2]}px`, paddingLeft: `${this.element.options.padding[3]}px`}"><table width="100%" cellspacing="0" cellpadding="0" border="0" :style="{borderTop: `${element.options.border.size}px ${element.options.border.style} ${element.options.border.color}`}"><tbody><tr><td width="100%"/></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table>'},imageTemplate:{props:["element"],template:'<table width="100%" class="main"  cellspacing="0" cellpadding="0" border="0" align="center" :style="{backgroundColor: element.options.backgroundColor, marginTop: `${element.options.margin[0]}px`, marginBottom: `${element.options.margin[2]}px`, marginLeft: `${element.options.margin[3]}px`, marginRight: `${element.options.margin[1]}px`}" style="display: table;" data-type="image"><tbody><tr><td :align="element.options.align" :style="{paddingTop: `${this.element.options.padding[0]}px`, paddingRight: `${this.element.options.padding[1]}px`, paddingBottom: `${this.element.options.padding[2]}px`, paddingLeft: `${this.element.options.padding[3]}px`}" class="image"><img border="0" :alt="element.options.altTag" style="display:block;max-width:100%;" :style="{width: `${element.options.width}px` }" :src="element.options.image" tabindex="0"></td></tr></tbody></table>'},videoTemplate:{props:["element"],computed:{iframeCode:function(){return"<iframe width="+("true"===this.element.options.fullWidth?"100%":this.element.options.width)+" height="+this.element.options.height+" src="+this.element.options.url+" frameborder='0' allowfullscreen></iframe>"}},template:'<table width="100%" class="main"  cellspacing="0" cellpadding="0" border="0" align="center" style="display: table;" data-type="image"><tbody><tr><td :style="{ paddingTop: `${element.options.margin[0]}px`, paddingBottom: `${element.options.margin[2]}px`, paddingLeft: `${element.options.margin[3]}px`, paddingRight: `${element.options.margin[1]}px`}"><table width="100%" class="main"  cellspacing="0" cellpadding="0" border="0" align="center"><tbody><tr><td :style="{ backgroundColor: element.options.backgroundColor, paddingTop: `${this.element.options.padding[0]}px`, paddingRight: `${this.element.options.padding[1]}px`, paddingBottom: `${this.element.options.padding[2]}px`, paddingLeft: `${this.element.options.padding[3]}px`, lineHeight: 0, textAlign: element.options.align}" class="video" :class="{fullWidth: element.options.fullWidth === \'true\'}" v-html="iframeCode"></td></tr></tbody></table></td></tr></tbody></table>'},productsTemplate:{props:["element","emailScreenMode"],computed:{productGrid:function(){for(var t=this.element.options.columns,e=this.element.options.rows,n='<table style="width: 100%">',i={name:"placeholder",image:"assets/154x160.jpg",price:"$999",buttonText:"Buy now!",buttonColor:"#00abee",buyURL:"/placeholder.url"},o=this.element.options.populateFromSource.isActive,a=this.element.options.products.length-1,r={},l=0;l<e;l++){n+="<tr>";for(var s=0;s<t;s++){var d=l*t+s;if(o)r=i;else if(r=this.element.options.products[d],d>a)break;var p=r.id===this.element.options.activeProduct?"border: 0px solid #00aeff":"",c=100/t;n+="<td","desktop"===this.emailScreenMode&&(n+=' class="productGridDesktop"'),"mobile"===this.emailScreenMode&&(n+=' class="productGridMobile"'),n+=' style="vertical-align:bottom; width:'+c+'%;"><div style="box-sizing: border-box; padding:2px; text-align: center; width: 100%; '+p+'">',n+='<div style="box-sizing: border-box;"><img style="max-width: 100%" src="'+r.image+'"></div>',n+='<div style="margin-bottom:20px;">',n+="true"===this.element.options.showProductName?'<h1 style="font-size: 20px; font-weight: bold; padding: 4px; margin: 0; margin-top: 8px;">'+r.name+"</h1>":"",n+="true"===this.element.options.showProductPrice?'<h2 style="padding: 8px; margin-bottom: 8px; font-size: 16px; margin-top: 0px;">'+r.price+"</h2>":"",n+="true"===this.element.options.showProductButton?'<a href="'+r.buyURL+'" style="display: inline-block; text-decoration: none; padding: 12px 20px; background-color: '+r.buttonColor+'; border: 0; border-radius: 2px; font-weight: bold; color: #fff;">'+r.buttonText+"</a>":"",n+="</div></div></td>"}n+="</tr>"}n+="</table>";this.element.options.fullWidth||this.element.options.width;return n}},template:'<table width="100%" cellspacing="0" cellpadding="0" border="0" align="center" style="display: table;" data-type="image"><tbody><template><tr><td style="padding: 4px;" :style="{ paddingTop: `${element.options.margin[0]}px`, paddingBottom: `${element.options.margin[2]}px`, paddingLeft: `${element.options.margin[3]}px`, paddingRight: `${element.options.margin[1]}px`}" :class="{fullWidth: element.options.fullWidth}"><table width="100%" cellspacing="0" cellpadding="0" border="0" align="center"><tbody><tr><td :style="{backgroundColor: element.options.backgroundColor, paddingTop: `${element.options.padding[0]}px`, paddingBottom: `${element.options.padding[2]}px`, paddingLeft: `${element.options.padding[3]}px`, paddingRight: `${element.options.padding[1]}px`}" v-html="productGrid"/></tr></tbody></table></td></tr></template></tbody></table>'}}})},e)},loading:{template:'<transition name="fade"><h1 class="loading" v-if="loading">Loading ...</h1></transition>',computed:{loading:function(){return this.$root._data.loading}}}}}).$mount("#app");Vue.directive("tinymceEditor",{twoWay:!0,bind:function(t,e,n){var i=t,o=[];tinymce.baseURL="bower_components/tinymce",setTimeout(function(){tinymce.init({target:i,inline:!0,skin:"lightgray",theme:"modern",plugins:["advlist autolink lists link image charmap","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste","textcolor"],toolbar:"bold italic forecolor alignleft aligncenter alignright alignjustify link",fontsize_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 24pt 36pt",setup:function(n){n.on("init",function(){o=$(t).next("textarea"),n.setContent(e.value)}),n.on("keyup change",function(){o.val(n.getContent({format:"raw"}));var t=new Event("input",{bubbles:!0});o.get(0).dispatchEvent(t)})}})},0)},update:function(t,e){var n=tinymce.get($(t).attr("id"));e.modifiers.update&&n.setContent(e.value)},unbind:function(t){tinymce.get($(t).attr("id")).destroy()}}),Vue.component("tinymce",{template:'<content ref="editor"><div v-html="value"></div></content>',name:"tiny-mce",props:["value"],mounted:function(){var t=this;tinymce.baseURL="bower_components/tinymce",tinymce.init({target:this.$refs.editor,inline:!0,skin:"lightgray",theme:"modern",plugins:["autolink link","paste","textcolor"],toolbar:"bold italic forecolor alignleft aligncenter alignright alignjustify link variables",menubar:!1,fontsize_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 24pt 36pt",setup:function(t){t.addButton("variables",{type:"menubutton",text:"Variables",icon:!1,menu:[{text:"var 1",onclick:function(){t.insertContent(" -## var 1 ##- ")}},{text:"var 2",onclick:function(){t.insertContent(" -## var 2 ##- ")}}]})},init_instance_callback:function(e){e.on("keyup change",function(n){var i=e.getContent({format:"raw"});"<div>"!==i.slice(0,5)&&(i=i.replace('<br data-mce-bogus="1">',""),i=i.replace("<br>",""),i="<div>"+i+"</div>",e.setContent(i)),t.$emit("input",i)})}})},destroyed:function(){tinymce.get(this.$refs.editor.id).destroy()}}),$(document).on("focusin",function(t){$(t.target).closest(".mce-window, .moxman-window").length&&t.stopImmediatePropagation()});var API={};API.getJSON=function(){var t=Object.assign({},emailBuilder.$children[0].Email);return t.html="",t},API.loadJSON=function(t){emailBuilder.$children[0].Email=JSON.parse(t)},API.getMJML=function(){return utils.compileMJML(emailBuilder.$children[0].Email)},API.onBrowseImages=function(){console.log("open modal")},API.selectImage=function(t){emailBuilder.$children[0].setImageURL(t)},API.onBrowseProducts=function(){console.log("open modal")},API.selectProducts=function(t){emailBuilder.$children[0].setProducts(t)};